name: Documentation

on:
  pull_request:
  push:
    branches:
      - 'master'
      - 'release-'
    tags: '*'

jobs:
  deploy_html:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install Julia
        run: |
          pip install jill
          jill install --confirm
      - name: Install dependencies
        run: julia --project=docs/ -e 'using Pkg; Pkg.develop(PackageSpec(path=pwd())); Pkg.instantiate()'
      - name: Build and deploy
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          DOCUMENTER_KEY: ${{ secrets.DOCUMENTER_KEY }}
        run: |
          julia -e 'include("contrib/build_sysimg.jl"); build_sysimg(force=true)'
          julia --project=doc/ doc/make.jl deploy
  # build_pdf:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v2
  #     - name: Build and deploy
  #       uses: docker://tianjun2018/documenter-latex:latest
  #       run: |
  #         apt-get update -q && apt-get install python3-pip -yq
  #         pip3 install jill && jill install --confirm
  #         julia -e 'using InteractiveUtils; versioninfo()'
  #         ls -al
  #         julia --project=doc/ -e 'using Pkg; Pkg.develop(PacakageSpec(path=pwd())); Pkg.instantiate()'
  #         julia --project=doc/ doc/make.jl pdf texplatform=native

