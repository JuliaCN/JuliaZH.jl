<!DOCTYPE html>
<html lang="zh-cn"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Asynchronous Programming Â· Juliaä¸­æ–‡æ–‡æ¡£</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-28835595-9', 'auto');
ga('send', 'pageview', {'page': location.pathname + location.search + location.hash});
</script><link rel="canonical" href="https://juliacn.github.io/JuliaZH.jl/latest/manual/asynchronous-programming/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/julia-manual.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Juliaä¸­æ–‡æ–‡æ¡£ logo"/></a><div class="docs-package-name"><span class="docs-autofit">Juliaä¸­æ–‡æ–‡æ¡£</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">ä¸»é¡µ</a></li><li><span class="tocitem">æ‰‹å†Œ</span><ul><li><a class="tocitem" href="../getting-started/">å…¥é—¨</a></li><li><a class="tocitem" href="../variables/">å˜é‡</a></li><li><a class="tocitem" href="../integers-and-floating-point-numbers/">æ•´æ•°å’Œæµ®ç‚¹æ•°</a></li><li><a class="tocitem" href="../mathematical-operations/">æ•°å­¦è¿ç®—å’Œåˆç­‰å‡½æ•°</a></li><li><a class="tocitem" href="../complex-and-rational-numbers/">å¤æ•°å’Œæœ‰ç†æ•°</a></li><li><a class="tocitem" href="../strings/">å­—ç¬¦ä¸²</a></li><li><a class="tocitem" href="../functions/">å‡½æ•°</a></li><li><a class="tocitem" href="../control-flow/">æµç¨‹æ§åˆ¶</a></li><li><a class="tocitem" href="../variables-and-scoping/">å˜é‡ä½œç”¨åŸŸ</a></li><li><a class="tocitem" href="../types/">ç±»å‹</a></li><li><a class="tocitem" href="../methods/">æ–¹æ³•</a></li><li><a class="tocitem" href="../constructors/">æ„é€ å‡½æ•°</a></li><li><a class="tocitem" href="../conversion-and-promotion/">ç±»å‹è½¬æ¢å’Œç±»å‹æå‡</a></li><li><a class="tocitem" href="../interfaces/">æ¥å£</a></li><li><a class="tocitem" href="../modules/">æ¨¡å—</a></li><li><a class="tocitem" href="../documentation/">æ–‡æ¡£</a></li><li><a class="tocitem" href="../metaprogramming/">å…ƒç¼–ç¨‹</a></li><li><a class="tocitem" href="../arrays/">å¤šç»´æ•°ç»„</a></li><li><a class="tocitem" href="../missing/">ç¼ºå¤±å€¼</a></li><li><a class="tocitem" href="../networking-and-streams/">ç½‘ç»œå’Œæµ</a></li><li><a class="tocitem" href="../parallel-computing/">å¹¶è¡Œè®¡ç®—</a></li><li class="is-active"><a class="tocitem" href>Asynchronous Programming</a><ul class="internal"><li><a class="tocitem" href="#Basic-Task-operations"><span>Basic <code>Task</code> operations</span></a></li><li><a class="tocitem" href="#Communicating-with-Channels"><span>Communicating with Channels</span></a></li><li><a class="tocitem" href="#More-task-operations"><span>More task operations</span></a></li><li><a class="tocitem" href="#Task-å’Œäº‹ä»¶"><span><code>Task</code> å’Œäº‹ä»¶</span></a></li></ul></li><li><a class="tocitem" href="../multi-threading/">å¤šçº¿ç¨‹</a></li><li><a class="tocitem" href="../distributed-computing/">Multi-processing and Distributed Computing</a></li><li><a class="tocitem" href="../running-external-programs/">è¿è¡Œå¤–éƒ¨ç¨‹åº</a></li><li><a class="tocitem" href="../calling-c-and-fortran-code/">è°ƒç”¨ C å’Œ Fortran ä»£ç </a></li><li><a class="tocitem" href="../handling-operating-system-variation/">å¤„ç†æ“ä½œç³»ç»Ÿå·®å¼‚</a></li><li><a class="tocitem" href="../environment-variables/">ç¯å¢ƒå˜é‡</a></li><li><a class="tocitem" href="../embedding/">åµŒå…¥ Julia</a></li><li><a class="tocitem" href="../code-loading/">ä»£ç åŠ è½½</a></li><li><a class="tocitem" href="../profile/">æ€§èƒ½åˆ†æ</a></li><li><a class="tocitem" href="../stacktraces/">æ ˆè·Ÿè¸ª</a></li><li><a class="tocitem" href="../performance-tips/">æ€§èƒ½å»ºè®®</a></li><li><a class="tocitem" href="../workflow-tips/">å·¥ä½œæµç¨‹å»ºè®®</a></li><li><a class="tocitem" href="../style-guide/">ä»£ç é£æ ¼æŒ‡å—</a></li><li><a class="tocitem" href="../faq/">å¸¸è§é—®é¢˜</a></li><li><a class="tocitem" href="../noteworthy-differences/">ä¸å…¶ä»–è¯­è¨€çš„æ˜¾è‘—å·®å¼‚</a></li><li><a class="tocitem" href="../unicode-input/">Unicode è¾“å…¥è¡¨</a></li><li><a class="tocitem" href="../command-line-options/">å‘½ä»¤è¡Œé€‰é¡¹</a></li></ul></li><li><span class="tocitem">Base</span><ul><li><a class="tocitem" href="../../base/base/">åŸºæœ¬åŠŸèƒ½</a></li><li><a class="tocitem" href="../../base/collections/">é›†åˆå’Œæ•°æ®ç»“æ„</a></li><li><a class="tocitem" href="../../base/math/">æ•°å­¦ç›¸å…³</a></li><li><a class="tocitem" href="../../base/numbers/">Numbers</a></li><li><a class="tocitem" href="../../base/strings/">å­—ç¬¦ä¸²</a></li><li><a class="tocitem" href="../../base/arrays/">æ•°ç»„</a></li><li><a class="tocitem" href="../../base/parallel/">Tasks</a></li><li><a class="tocitem" href="../../base/multi-threading/">Multi-Threading</a></li><li><a class="tocitem" href="../../base/constants/">å¸¸é‡</a></li><li><a class="tocitem" href="../../base/file/">æ–‡ä»¶ç³»ç»Ÿ</a></li><li><a class="tocitem" href="../../base/io-network/">I/O ä¸ç½‘ç»œ</a></li><li><a class="tocitem" href="../../base/punctuation/">è¿ç®—ç¬¦ä¸è®°å·</a></li><li><a class="tocitem" href="../../base/sort/">æ’åºåŠç›¸å…³å‡½æ•°</a></li><li><a class="tocitem" href="../../base/iterators/">è¿­ä»£ç›¸å…³</a></li><li><a class="tocitem" href="../../base/c/">C æ¥å£</a></li><li><a class="tocitem" href="../../base/libc/">C æ ‡å‡†åº“</a></li><li><a class="tocitem" href="../../base/stacktraces/">å †æ ˆè·Ÿè¸ª</a></li><li><a class="tocitem" href="../../base/simd-types/">SIMD æ”¯æŒ</a></li></ul></li><li><span class="tocitem">Standard Library</span><ul><li><a class="tocitem" href="../../stdlib/Artifacts/">Artifacts</a></li><li><a class="tocitem" href="../../stdlib/Base64/">Base64</a></li><li><a class="tocitem" href="../../stdlib/CRC32c/">CRC32c</a></li><li><a class="tocitem" href="../../stdlib/Dates/">æ—¥æœŸ</a></li><li><a class="tocitem" href="../../stdlib/DelimitedFiles/">åˆ†éš”ç¬¦æ–‡ä»¶</a></li><li><a class="tocitem" href="../../stdlib/Distributed/">Distributed Computing</a></li><li><a class="tocitem" href="../../stdlib/FileWatching/">æ–‡ä»¶ç›¸å…³äº‹ä»¶</a></li><li><a class="tocitem" href="../../stdlib/Future/">Future</a></li><li><a class="tocitem" href="../../stdlib/InteractiveUtils/">Interactive Utilities</a></li><li><a class="tocitem" href="../../stdlib/LazyArtifacts/">Lazy Artifacts</a></li><li><a class="tocitem" href="../../stdlib/LibGit2/">LibGit2</a></li><li><a class="tocitem" href="../../stdlib/Libdl/">åŠ¨æ€é“¾æ¥å™¨</a></li><li><a class="tocitem" href="../../stdlib/LinearAlgebra/">Linear Algebra</a></li><li><a class="tocitem" href="../../stdlib/Logging/">æ—¥å¿—è®°å½•</a></li><li><a class="tocitem" href="../../stdlib/Markdown/">Markdown</a></li><li><a class="tocitem" href="../../stdlib/Mmap/">å†…å­˜æ˜ å°„ I/O</a></li><li><a class="tocitem" href="../../stdlib/Printf/">Printf</a></li><li><a class="tocitem" href="../../stdlib/Profile/">æ€§èƒ½åˆ†æ</a></li><li><a class="tocitem" href="../../stdlib/REPL/">Julia REPL</a></li><li><a class="tocitem" href="../../stdlib/Random/">éšæœºæ•°</a></li><li><a class="tocitem" href="../../stdlib/SHA/">SHA</a></li><li><a class="tocitem" href="../../stdlib/Serialization/">åºåˆ—åŒ–</a></li><li><a class="tocitem" href="../../stdlib/SharedArrays/">å…±äº«æ•°ç»„</a></li><li><a class="tocitem" href="../../stdlib/Sockets/">å¥—æ¥å­—</a></li><li><a class="tocitem" href="../../stdlib/SparseArrays/">ç¨€ç–æ•°ç»„</a></li><li><a class="tocitem" href="../../stdlib/Statistics/">ç»Ÿè®¡</a></li><li><a class="tocitem" href="../../stdlib/TOML/">TOML</a></li><li><a class="tocitem" href="../../stdlib/Test/">å•å…ƒæµ‹è¯•</a></li><li><a class="tocitem" href="../../stdlib/UUIDs/">UUIDs</a></li><li><a class="tocitem" href="../../stdlib/Unicode/">Unicode</a></li></ul></li><li><span class="tocitem">Developer Documentation</span><ul><li><a class="tocitem" href="../../devdocs/reflection/">åå°„ ä¸ è‡ªæˆ‘æ£€æŸ¥</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Documentation of Julia&#39;s Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../devdocs/init/">Julia è¿è¡Œæ—¶çš„åˆå§‹åŒ–</a></li><li><a class="tocitem" href="../../devdocs/ast/">Julia çš„ AST</a></li><li><a class="tocitem" href="../../devdocs/types/">More about types</a></li><li><a class="tocitem" href="../../devdocs/object/">Memory layout of Julia Objects</a></li><li><a class="tocitem" href="../../devdocs/eval/">Julia ä»£ç çš„ eval</a></li><li><a class="tocitem" href="../../devdocs/callconv/">Calling Conventions</a></li><li><a class="tocitem" href="../../devdocs/compiler/">æœ¬æœºä»£ç ç”Ÿæˆè¿‡ç¨‹çš„é«˜çº§æ¦‚è¿°</a></li><li><a class="tocitem" href="../../devdocs/functions/">Julia å‡½æ•°</a></li><li><a class="tocitem" href="../../devdocs/cartesian/">ç¬›å¡å°”</a></li><li><a class="tocitem" href="../../devdocs/meta/">Talking to the compiler (the <code>:meta</code> mechanism)</a></li><li><a class="tocitem" href="../../devdocs/subarrays/">å­æ•°ç»„</a></li><li><a class="tocitem" href="../../devdocs/isbitsunionarrays/">isbits Union Optimizations</a></li><li><a class="tocitem" href="../../devdocs/sysimg/">System Image Building</a></li><li><a class="tocitem" href="../../devdocs/llvm/">Working with LLVM</a></li><li><a class="tocitem" href="../../devdocs/stdio/">printf() and stdio in the Julia runtime</a></li><li><a class="tocitem" href="../../devdocs/boundscheck/">è¾¹ç•Œæ£€æŸ¥</a></li><li><a class="tocitem" href="../../devdocs/locks/">Proper maintenance and care of multi-threading locks</a></li><li><a class="tocitem" href="../../devdocs/offset-arrays/">Arrays with custom indices</a></li><li><a class="tocitem" href="../../devdocs/require/">Module loading</a></li><li><a class="tocitem" href="../../devdocs/inference/">ç±»å‹æ¨å¯¼</a></li><li><a class="tocitem" href="../../devdocs/ssair/">Julia SSA-form IR</a></li><li><a class="tocitem" href="../../devdocs/gc-sa/">Static analyzer annotations for GC correctness in C code</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Developing/debugging Julia&#39;s C code</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../devdocs/backtraces/">æŠ¥å‘Šå’Œåˆ†æå´©æºƒï¼ˆæ®µé”™è¯¯ï¼‰</a></li><li><a class="tocitem" href="../../devdocs/debuggingtips/">gdb è°ƒè¯•æç¤º</a></li><li><a class="tocitem" href="../../devdocs/valgrind/">åœ¨Juliaä¸­ä½¿ç”¨Valgrind</a></li><li><a class="tocitem" href="../../devdocs/sanitizers/">Sanitizer support</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">æ‰‹å†Œ</a></li><li class="is-active"><a href>Asynchronous Programming</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Asynchronous Programming</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://www.transifex.com/juliacn/manual-zh_cn/translate/#zh_CN/asynchronous-programmingmd" title=" å®Œå–„ Transifex ä¸Šçš„ç¿»è¯‘"><span class="docs-icon fab">ï‚¬</span><span class="docs-label is-hidden-touch"> å®Œå–„ Transifex ä¸Šçš„ç¿»è¯‘</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="è®¾ç½®"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="man-asynchronous"><a class="docs-heading-anchor" href="#man-asynchronous">Asynchronous Programming</a><a id="man-asynchronous-1"></a><a class="docs-heading-anchor-permalink" href="#man-asynchronous" title="Permalink"></a></h1><p>When a program needs to interact with the outside world, for example communicating with another machine over the internet, operations in the program may need to happen in an unpredictable order. Say your program needs to download a file. We would like to initiate the download operation, perform other operations while we wait for it to complete, and then resume the code that needs the downloaded file when it is available. This sort of scenario falls in the domain of asynchronous programming, sometimes also referred to as concurrent programming (since, conceptually, multiple things are happening at once).</p><p>To address these scenarios, Julia provides <a href="../../base/parallel/#Core.Task"><code>Task</code></a>s (also known by several other names, such as symmetric coroutines, lightweight threads, cooperative multitasking, or one-shot continuations). When a piece of computing work (in practice, executing a particular function) is designated as a <a href="../../base/parallel/#Core.Task"><code>Task</code></a>, it becomes possible to interrupt it by switching to another <a href="../../base/parallel/#Core.Task"><code>Task</code></a>. The original <a href="../../base/parallel/#Core.Task"><code>Task</code></a> can later be resumed, at which point it will pick up right where it left off. At first, this may seem similar to a function call. However there are two key differences. First, switching tasks does not use any space, so any number of task switches can occur without consuming the call stack. Second, switching among tasks can occur in any order, unlike function calls, where the called function must finish executing before control returns to the calling function.</p><h2 id="Basic-Task-operations"><a class="docs-heading-anchor" href="#Basic-Task-operations">Basic <code>Task</code> operations</a><a id="Basic-Task-operations-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Task-operations" title="Permalink"></a></h2><p>You can think of a <code>Task</code> as a handle to a unit of computational work to be performed. It has a create-start-run-finish lifecycle. Tasks are created by calling the <code>Task</code> constructor on a 0-argument function to run, or using the <a href="../../base/parallel/#Base.@task"><code>@task</code></a> macro:</p><pre><code class="language-julia-repl">julia&gt; t = @task begin; sleep(5); println(&quot;done&quot;); end
Task (runnable) @0x00007f13a40c0eb0</code></pre><p><code>@task x</code> is equivalent to <code>Task(()-&gt;x)</code>.</p><p>This task will wait for five seconds, and then print <code>done</code>. However, it has not started running yet. We can run it whenever we&#39;re ready by calling <a href="../../base/parallel/#Base.schedule"><code>schedule</code></a>:</p><pre><code class="language-julia-repl">julia&gt; schedule(t);</code></pre><p>If you try this in the REPL, you will see that <code>schedule</code> returns immediately. That is because it simply adds <code>t</code> to an internal queue of tasks to run. Then, the REPL will print the next prompt and wait for more input. Waiting for keyboard input provides an opportunity for other tasks to run, so at that point <code>t</code> will start. <code>t</code> calls <a href="../../base/parallel/#Base.sleep"><code>sleep</code></a>, which sets a timer and stops execution. If other tasks have been scheduled, they could run then. After five seconds, the timer fires and restarts <code>t</code>, and you will see <code>done</code> printed. <code>t</code> is then finished.</p><p>The <a href="../../base/parallel/#Base.wait"><code>wait</code></a> function blocks the calling task until some other task finishes. So for example if you type</p><pre><code class="language-julia-repl">julia&gt; schedule(t); wait(t)</code></pre><p>instead of only calling <code>schedule</code>, you will see a five second pause before the next input prompt appears. That is because the REPL is waiting for <code>t</code> to finish before proceeding.</p><p>It is common to want to create a task and schedule it right away, so the macro <a href="../../base/parallel/#Base.@async"><code>@async</code></a> is provided for that purpose â€“- <code>@async x</code> is equivalent to <code>schedule(@task x)</code>.</p><h2 id="Communicating-with-Channels"><a class="docs-heading-anchor" href="#Communicating-with-Channels">Communicating with Channels</a><a id="Communicating-with-Channels-1"></a><a class="docs-heading-anchor-permalink" href="#Communicating-with-Channels" title="Permalink"></a></h2><p>In some problems, the various pieces of required work are not naturally related by function calls; there is no obvious &quot;caller&quot; or &quot;callee&quot; among the jobs that need to be done. An example is the producer-consumer problem, where one complex procedure is generating values and another complex procedure is consuming them. The consumer cannot simply call a producer function to get a value, because the producer may have more values to generate and so might not yet be ready to return. With tasks, the producer and consumer can both run as long as they need to, passing values back and forth as necessary.</p><p>Julia æä¾›äº† <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a> æœºåˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¸€ä¸ª <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a> æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ï¼Œå…è®¸å¤šä¸ª <code>Task</code> å¯¹å®ƒå¯ä»¥è¿›è¡Œè¯»å’Œå†™ã€‚</p><p>è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç”Ÿäº§è€…ä»»åŠ¡ï¼Œè°ƒç”¨ <a href="../../base/parallel/#Base.put!-Tuple{Channel, Any}"><code>put!</code></a> æ¥ç”Ÿäº§æ•°å€¼ã€‚ä¸ºäº†æ¶ˆè´¹æ•°å€¼ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç”Ÿäº§è€…å¼€å§‹æ–°ä»»åŠ¡è¿›è¡Œæ’ç­ã€‚å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„ <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a> ç»„ä»¶æ¥è¿è¡Œä¸€ä¸ªä¸å…¶ç»‘å®šçš„ <code>Task</code>ï¼Œå®ƒèƒ½æ¥å—å•å‚æ•°å‡½æ•°ä½œä¸ºå…¶å‚æ•°ï¼Œç„¶åå¯ä»¥ç”¨ <a href="../../base/io-network/#Base.take!-Tuple{Base.GenericIOBuffer}"><code>take!</code></a> ä» <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a> å¯¹è±¡é‡Œä¸æ–­åœ°æå–å€¼ï¼š</p><pre><code class="language-julia-repl">julia&gt; function producer(c::Channel)
           put!(c, &quot;start&quot;)
           for n=1:4
               put!(c, 2n)
           end
           put!(c, &quot;stop&quot;)
       end;

julia&gt; chnl = Channel(producer);

julia&gt; take!(chnl)
&quot;start&quot;

julia&gt; take!(chnl)
2

julia&gt; take!(chnl)
4

julia&gt; take!(chnl)
6

julia&gt; take!(chnl)
8

julia&gt; take!(chnl)
&quot;stop&quot;</code></pre><p>ä¸€ç§æ€è€ƒè¿™ç§è¡Œä¸ºçš„æ–¹å¼æ˜¯ï¼Œâ€œç”Ÿäº§è€…â€èƒ½å¤Ÿå¤šæ¬¡è¿”å›ã€‚åœ¨ä¸¤æ¬¡è°ƒç”¨ <a href="../../base/parallel/#Base.put!-Tuple{Channel, Any}"><code>put!</code></a> ä¹‹é—´ï¼Œç”Ÿäº§è€…çš„æ‰§è¡Œæ˜¯æŒ‚èµ·çš„ï¼Œæ­¤æ—¶ç”±æ¶ˆè´¹è€…æ¥ç®¡æ§åˆ¶ã€‚</p><p>è¿”å›çš„ <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a> å¯ä»¥è¢«ç”¨ä½œä¸€ä¸ª <code>for</code> å¾ªç¯çš„è¿­ä»£å¯¹è±¡ï¼Œæ­¤æ—¶å¾ªç¯å˜é‡ä¼šä¾æ¬¡å–åˆ°æ‰€æœ‰äº§ç”Ÿçš„å€¼ã€‚å½“ <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a> å…³é—­æ—¶ï¼Œå¾ªç¯å°±ä¼šç»ˆæ­¢ã€‚</p><pre><code class="language-julia-repl">julia&gt; for x in Channel(producer)
           println(x)
       end
start
2
4
6
8
stop</code></pre><p>æ³¨æ„æˆ‘ä»¬å¹¶ä¸éœ€è¦æ˜¾å¼åœ°åœ¨ç”Ÿäº§è€…ä¸­å…³é—­ <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a>ã€‚è¿™æ˜¯å› ä¸º <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a> å¯¹ <a href="../../base/parallel/#Core.Task"><code>Task</code></a> çš„ç»‘å®šåŒæ—¶ä¹Ÿæ„å‘³ç€ <code>Channel</code> çš„ç”Ÿå‘½å‘¨æœŸä¸ç»‘å®šçš„ <code>Task</code> ä¸€è‡´ã€‚å½“ <code>Task</code> ç»“æŸæ—¶ï¼Œ<code>Channel</code> å¯¹è±¡ä¼šè‡ªåŠ¨å…³é—­ã€‚å¤šä¸ª <code>Channel</code> å¯ä»¥ç»‘å®šåˆ°ä¸€ä¸ª <code>Task</code>ï¼Œåä¹‹äº¦ç„¶ã€‚</p><p>While the <a href="../../base/parallel/#Core.Task"><code>Task</code></a> constructor expects a 0-argument function, the <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a> method that creates a task-bound channel expects a function that accepts a single argument of type <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a>. A common pattern is for the producer to be parameterized, in which case a partial function application is needed to create a 0 or 1 argument <a href="../functions/#man-anonymous-functions">anonymous function</a>.</p><p>å¯¹äº <a href="../../base/parallel/#Core.Task"><code>Task</code></a> å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸ºäº†æ–¹ä¾¿ç”¨å®ã€‚</p><pre><code class="language-julia">function mytask(myarg)
    ...
end

taskHdl = Task(() -&gt; mytask(7))
# or, equivalently
taskHdl = @task mytask(7)</code></pre><p>ä¸ºäº†å®‰æ’æ›´é«˜çº§çš„å·¥ä½œåˆ†é…æ¨¡å¼ï¼Œ<a href="../../stdlib/Sockets/#Base.bind"><code>bind</code></a> å’Œ <a href="../../base/parallel/#Base.schedule"><code>schedule</code></a> å¯ä»¥ä¸ <a href="../../base/parallel/#Core.Task"><code>Task</code></a> å’Œ <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a> æ„é€ å‡½æ•°é…åˆä½¿ç”¨ï¼Œæ˜¾å¼åœ°è¿æ¥ä¸€äº› <code>Channel</code> å’Œç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€… <code>Task</code>ã€‚</p><h3 id="More-on-Channels"><a class="docs-heading-anchor" href="#More-on-Channels">More on Channels</a><a id="More-on-Channels-1"></a><a class="docs-heading-anchor-permalink" href="#More-on-Channels" title="Permalink"></a></h3><p>ä¸€ä¸ªç®¡é“å¯ä»¥å½¢è±¡å¾—çœ‹åšæ˜¯ä¸€ä¸ªç®¡å­ï¼Œä¸€ç«¯å¯è¯»ï¼Œå¦ä¸€ç«¯å¯å†™ï¼š</p><ul><li><p>ä¸åŒçš„ task å¯ä»¥é€šè¿‡ <a href="../../base/parallel/#Base.put!-Tuple{Channel, Any}"><code>put!</code></a> å¾€åŒä¸€ä¸ª channel å¹¶å‘åœ°å†™å…¥ã€‚</p></li><li><p>ä¸åŒçš„ task ä¹Ÿå¯ä»¥é€šè¿‡ <a href="../../base/io-network/#Base.take!-Tuple{Base.GenericIOBuffer}"><code>take!</code></a> ä»åŒä¸€ä¸ª channel å¹¶å‘åœ°å–æ•°æ®</p></li><li><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><pre><code class="language-julia"># Given Channels c1 and c2,
c1 = Channel(32)
c2 = Channel(32)

# and a function `foo` which reads items from c1, processes the item read
# and writes a result to c2,
function foo()
    while true
        data = take!(c1)
        [...]               # process data
        put!(c2, result)    # write out result
    end
end

# we can schedule `n` instances of `foo` to be active concurrently.
for _ in 1:n
    errormonitor(@async foo())
end</code></pre></li><li><p>Channel å¯ä»¥é€šè¿‡ <code>Channel{T}(sz)</code> æ„é€ ï¼Œå¾—åˆ°çš„ channel åªèƒ½å­˜å‚¨ç±»å‹ <code>T</code> çš„æ•°æ®ã€‚å¦‚æœ <code>T</code> æ²¡æœ‰æŒ‡å®šï¼Œé‚£ä¹ˆ channel å¯ä»¥å­˜ä»»æ„ç±»å‹ã€‚<code>sz</code> è¡¨ç¤ºè¯¥ channel èƒ½å¤Ÿå­˜å‚¨çš„æœ€å¤§å…ƒç´ ä¸ªæ•°ã€‚æ¯”å¦‚ <code>Channel(32)</code> å¾—åˆ°çš„ channel æœ€å¤šå¯ä»¥å­˜å‚¨32ä¸ªå…ƒç´ ã€‚è€Œ <code>Channel{MyType}(64)</code> åˆ™å¯ä»¥æœ€å¤šå­˜å‚¨64ä¸ª <code>MyType</code> ç±»å‹çš„æ•°æ®ã€‚</p></li><li><p>å¦‚æœä¸€ä¸ª <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a> æ˜¯ç©ºçš„ï¼Œè¯»å–çš„ task(å³æ‰§è¡Œ <a href="../../base/io-network/#Base.take!-Tuple{Base.GenericIOBuffer}"><code>take!</code></a> çš„ task)ä¼šè¢«é˜»å¡ç›´åˆ°æœ‰æ–°çš„æ•°æ®å‡†å¤‡å¥½äº†ã€‚</p></li><li><p>å¦‚æœä¸€ä¸ª <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a> æ˜¯æ»¡çš„ï¼Œé‚£ä¹ˆå†™å…¥çš„ task(å³æ‰§è¡Œ <a href="../../base/parallel/#Base.put!-Tuple{Channel, Any}"><code>put!</code></a> çš„ task)åˆ™ä¼šè¢«é˜»å¡ï¼Œç›´åˆ° Channel æœ‰ç©ºä½™ã€‚</p></li><li><p><a href="../../base/parallel/#Base.isready-Tuple{Channel}"><code>isready</code></a> tests for the presence of any object in the channel, while <a href="../../base/parallel/#Base.wait"><code>wait</code></a></p></li><li><p>ä¸€ä¸ª <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a> ä¸€å¼€å§‹å¤„äºå¼€å¯çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥è¢« <a href="../../base/io-network/#Base.take!-Tuple{Base.GenericIOBuffer}"><code>take!</code></a> è¯»å–å’Œ <a href="../../base/parallel/#Base.put!-Tuple{Channel, Any}"><code>put!</code></a> å†™å…¥ã€‚<a href="../../base/io-network/#Base.close"><code>close</code></a> ä¼šå…³é—­ä¸€ä¸ª <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a>ï¼Œå¯¹äºä¸€ä¸ªå·²ç»å…³é—­çš„ <a href="../../base/parallel/#Base.Channel"><code>Channel</code></a>ï¼Œ<a href="../../base/parallel/#Base.put!-Tuple{Channel, Any}"><code>put!</code></a> ä¼šå¤±è´¥ï¼Œä¾‹å¦‚ï¼š</p><pre><code class="language-julia-repl">julia&gt; c = Channel(2);

julia&gt; put!(c, 1) # `put!` on an open channel succeeds
1

julia&gt; close(c);

julia&gt; put!(c, 2) # `put!` on a closed channel throws an exception.
ERROR: InvalidStateException(&quot;Channel is closed.&quot;,:closed)
Stacktrace:
[...]</code></pre></li><li><p><a href="../../base/io-network/#Base.take!-Tuple{Base.GenericIOBuffer}"><code>take!</code></a> å’Œ <a href="../../base/parallel/#Base.fetch-Tuple{Task}"><code>fetch</code></a> (åªè¯»å–ï¼Œä¸ä¼šå°†å…ƒç´ ä» channel ä¸­åˆ æ‰)ä»ç„¶å¯ä»¥ä»ä¸€ä¸ªå·²ç»å…³é—­çš„ channel ä¸­è¯»æ•°æ®ï¼Œç›´åˆ° channel è¢«å–ç©ºäº†ä¸ºæ­¢ã€‚ç»§ç»­ä¸Šé¢çš„ä¾‹å­ï¼š</p><pre><code class="language-julia-repl">julia&gt; fetch(c) # Any number of `fetch` calls succeed.
1

julia&gt; fetch(c)
1

julia&gt; take!(c) # The first `take!` removes the value.
1

julia&gt; take!(c) # No more data available on a closed channel.
ERROR: InvalidStateException(&quot;Channel is closed.&quot;,:closed)
Stacktrace:
[...]</code></pre></li></ul><p>è€ƒè™‘è¿™æ ·ä¸€ä¸ªç”¨ channel åš task ä¹‹é—´é€šä¿¡çš„ä¾‹å­ã€‚é¦–å…ˆï¼Œèµ· 4 ä¸ª task æ¥å¤„ç†ä¸€ä¸ª <code>jobs</code> channel ä¸­çš„æ•°æ®ã€‚<code>jobs</code> ä¸­çš„æ¯ä¸ªä»»åŠ¡é€šè¿‡ <code>job_id</code> æ¥è¡¨ç¤ºï¼Œç„¶åæ¯ä¸ª task æ¨¡æ‹Ÿè¯»å–ä¸€ä¸ª <code>job_id</code>ï¼Œç„¶åéšæœºç­‰å¾…ä¸€ä¼šå„¿ï¼Œç„¶åå¾€ä¸€ä¸ª results channel ä¸­å†™å…¥ä¸€ä¸ªå…ƒç»„ï¼Œå®ƒåˆ†åˆ«åŒ…å« <code>job_id</code> å’Œæ‰§è¡Œçš„æ—¶é—´ï¼Œæœ€åå°†ç»“æœæ‰“å°å‡ºæ¥ï¼š</p><pre><code class="language-julia-repl">julia&gt; const jobs = Channel{Int}(32);

julia&gt; const results = Channel{Tuple}(32);

julia&gt; function do_work()
           for job_id in jobs
               exec_time = rand()
               sleep(exec_time)                # simulates elapsed time doing actual work
                                               # typically performed externally.
               put!(results, (job_id, exec_time))
           end
       end;

julia&gt; function make_jobs(n)
           for i in 1:n
               put!(jobs, i)
           end
       end;

julia&gt; n = 12;

julia&gt; errormonitor(@async make_jobs(n)); # feed the jobs channel with &quot;n&quot; jobs

julia&gt; for i in 1:4 # start 4 tasks to process requests in parallel
           errormonitor(@async do_work())
       end

julia&gt; @elapsed while n &gt; 0 # print out results
           job_id, exec_time = take!(results)
           println(&quot;$job_id finished in $(round(exec_time; digits=2)) seconds&quot;)
           global n = n - 1
       end
4 finished in 0.22 seconds
3 finished in 0.45 seconds
1 finished in 0.5 seconds
7 finished in 0.14 seconds
2 finished in 0.78 seconds
5 finished in 0.9 seconds
9 finished in 0.36 seconds
6 finished in 0.87 seconds
8 finished in 0.79 seconds
10 finished in 0.64 seconds
12 finished in 0.5 seconds
11 finished in 0.97 seconds
0.029772311</code></pre><p>Instead of <code>errormonitor(t)</code>, a more robust solution may be use use <code>bind(results, t)</code>, as that will not only log any unexpected failures, but also force the associated resources to close and propagate the exception everywhere.</p><h2 id="More-task-operations"><a class="docs-heading-anchor" href="#More-task-operations">More task operations</a><a id="More-task-operations-1"></a><a class="docs-heading-anchor-permalink" href="#More-task-operations" title="Permalink"></a></h2><p>Task operations are built on a low-level primitive called <a href="../../base/parallel/#Base.yieldto"><code>yieldto</code></a>. <code>yieldto(task, value)</code> suspends the current task, switches to the specified <code>task</code>, and causes that task&#39;s last <a href="../../base/parallel/#Base.yieldto"><code>yieldto</code></a> call to return the specified <code>value</code>. Notice that <a href="../../base/parallel/#Base.yieldto"><code>yieldto</code></a> is the only operation required to use task-style control flow; instead of calling and returning we are always just switching to a different task. This is why this feature is also called &quot;symmetric coroutines&quot;; each task is switched to and from using the same mechanism.</p><p><a href="../../base/parallel/#Base.yieldto"><code>yieldto</code></a> åŠŸèƒ½å¼ºå¤§ï¼Œä½†å¤§å¤šæ•° <code>Task</code> çš„ä½¿ç”¨éƒ½ä¸ä¼šç›´æ¥è°ƒç”¨å®ƒã€‚æ€è€ƒä¸ºä»€ä¹ˆä¼šè¿™æ ·ã€‚å¦‚æœä½ åˆ‡æ¢å½“å‰ <code>Task</code>ï¼Œä½ å¾ˆå¯èƒ½ä¼šåœ¨æŸä¸ªæ—¶å€™æƒ³åˆ‡æ¢å›æ¥ã€‚ä½†çŸ¥é“ä»€ä¹ˆæ—¶å€™åˆ‡æ¢å›æ¥å’Œé‚£ä¸ª <code>Task</code> è´Ÿè´£åˆ‡æ¢å›æ¥éœ€è¦å¤§é‡çš„åè°ƒã€‚ä¾‹å¦‚ï¼Œ<a href="../../base/parallel/#Base.put!-Tuple{Channel, Any}"><code>put!</code></a> å’Œ <a href="../../base/io-network/#Base.take!-Tuple{Base.GenericIOBuffer}"><code>take!</code></a> æ˜¯é˜»å¡æ“ä½œï¼Œå½“åœ¨æ¸ é“ç¯å¢ƒä¸­ä½¿ç”¨æ—¶ï¼Œç»´æŒçŠ¶æ€ä»¥è®°ä½æ¶ˆè´¹è€…æ˜¯è°ã€‚ä¸éœ€è¦äººä¸ºåœ°è®°å½•æ¶ˆè´¹ <code>Task</code>ï¼Œæ­£æ˜¯ä½¿å¾— <a href="../../base/parallel/#Base.put!-Tuple{Channel, Any}"><code>put!</code></a> æ¯”åº•å±‚ <a href="../../base/parallel/#Base.yieldto"><code>yieldto</code></a> æ˜“ç”¨çš„åŸå› ã€‚</p><p>é™¤äº† <a href="../../base/parallel/#Base.yieldto"><code>yieldto</code></a> ä¹‹å¤–ï¼Œä¹Ÿéœ€è¦ä¸€äº›å…¶å®ƒçš„åŸºæœ¬å‡½æ•°æ¥æ›´é«˜æ•ˆåœ°ä½¿ç”¨ <code>Task</code>ã€‚</p><ul><li><a href="../../base/parallel/#Base.current_task"><code>current_task</code></a> è·å–å½“å‰è¿è¡Œ <code>Task</code> çš„ç´¢å¼•ã€‚</li><li><a href="../../base/parallel/#Base.istaskdone"><code>istaskdone</code></a> æŸ¥è¯¢ä¸€ä¸ª <code>Task</code> æ˜¯å¦é€€å‡º.</li><li><a href="../../base/parallel/#Base.istaskstarted"><code>istaskstarted</code></a> æŸ¥è¯¢ä¸€ä¸ª <code>Task</code> æ˜¯å¦å·²ç»å¼€å§‹è¿è¡Œã€‚</li><li><a href="../../base/parallel/#Base.task_local_storage-Tuple{Any}"><code>task_local_storage</code></a> æ“çºµé’ˆå¯¹å½“å‰ <code>Task</code> çš„é”®å€¼å­˜å‚¨ã€‚</li></ul><h2 id="Task-å’Œäº‹ä»¶"><a class="docs-heading-anchor" href="#Task-å’Œäº‹ä»¶"><code>Task</code> å’Œäº‹ä»¶</a><a id="Task-å’Œäº‹ä»¶-1"></a><a class="docs-heading-anchor-permalink" href="#Task-å’Œäº‹ä»¶" title="Permalink"></a></h2><p>å¤šæ•° <code>Task</code> åˆ‡æ¢æ˜¯åœ¨ç­‰å¾…å¦‚ I/O è¯·æ±‚çš„äº‹ä»¶ï¼Œç”± Julia Base é‡Œçš„è°ƒåº¦å™¨æ‰§è¡Œã€‚è°ƒåº¦å™¨ç»´æŒä¸€ä¸ªå¯è¿è¡Œ <code>Task</code> çš„é˜Ÿåˆ—ï¼Œå¹¶æ‰§è¡Œä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œæ¥æ ¹æ®ä¾‹å¦‚æ”¶åˆ°æ¶ˆæ¯ç­‰å¤–éƒ¨äº‹ä»¶æ¥é‡å¯ <code>Task</code>ã€‚</p><p>ç­‰å¾…ä¸€ä¸ªäº‹ä»¶çš„åŸºæœ¬å‡½æ•°æ˜¯ <a href="../../base/parallel/#Base.wait"><code>wait</code></a>ã€‚å¾ˆå¤šå¯¹è±¡éƒ½å®ç°äº† <a href="../../base/parallel/#Base.wait"><code>wait</code></a> å‡½æ•°ï¼›ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ª <code>Process</code> å¯¹è±¡ï¼Œ<a href="../../base/parallel/#Base.wait"><code>wait</code></a> å°†ç­‰å¾…å®ƒé€€å‡ºã€‚<a href="../../base/parallel/#Base.wait"><code>wait</code></a> é€šå¸¸æ˜¯éšå¼çš„ï¼Œä¾‹å¦‚ï¼Œ<a href="../../base/parallel/#Base.wait"><code>wait</code></a> å¯èƒ½å‘ç”Ÿåœ¨è°ƒç”¨ <a href="../../base/io-network/#Base.read"><code>read</code></a> æ—¶ç­‰å¾…æ•°æ®å¯ç”¨ã€‚</p><p>åœ¨æ‰€æœ‰è¿™äº›æƒ…å†µä¸‹ï¼Œ<a href="../../base/parallel/#Base.wait"><code>wait</code></a> æœ€ç»ˆä¼šæ“ä½œä¸€ä¸ª <a href="../../base/parallel/#Base.Condition"><code>Condition</code></a> å¯¹è±¡ï¼Œç”±å®ƒè´Ÿè´£æ’é˜Ÿå’Œé‡å¯ <code>Task</code>ã€‚å½“ <code>Task</code> åœ¨ä¸€ä¸ª <a href="../../base/parallel/#Base.Condition"><code>Condition</code></a> ä¸Šè°ƒç”¨ <a href="../../base/parallel/#Base.wait"><code>wait</code></a> æ—¶ï¼Œè¯¥ Task å°±è¢«æ ‡è®°ä¸ºä¸å¯æ‰§è¡Œï¼ŒåŠ åˆ°æ¡ä»¶çš„é˜Ÿåˆ—ä¸­ï¼Œå¹¶åˆ‡å›è°ƒåº¦å™¨ã€‚è°ƒåº¦å™¨å°†é€‰æ‹©å¦ä¸€ä¸ª <code>Task</code> æ¥è¿è¡Œï¼Œæˆ–è€…é˜»æ­¢å¤–éƒ¨äº‹ä»¶çš„ç­‰å¾…ã€‚å¦‚æœæ‰€æœ‰è¿è¡Œè‰¯å¥½ï¼Œæœ€ç»ˆä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨å°†åœ¨è¿™ä¸ªæ¡ä»¶ä¸‹è°ƒç”¨ <a href="../../base/parallel/#Base.notify"><code>notify</code></a>ï¼Œä½¿å¾—ç­‰å¾…è¯¥æ¡ä»¶çš„ <code>Task</code> åˆå˜æˆå¯è¿è¡Œã€‚</p><p>A task created explicitly by calling <a href="../../base/parallel/#Core.Task"><code>Task</code></a> is initially not known to the scheduler. This allows you to manage tasks manually using <a href="../../base/parallel/#Base.yieldto"><code>yieldto</code></a> if you wish. However, when such a task waits for an event, it still gets restarted automatically when the event happens, as you would expect.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../parallel-computing/">Â« å¹¶è¡Œè®¡ç®—</a><a class="docs-footer-nextpage" href="../multi-threading/">å¤šçº¿ç¨‹ Â»</a><div class="flexbox-break"></div><p class="footer-message">ğŸ“¢ğŸ“¢ğŸ“¢Juliaä¸­æ–‡ç¤¾åŒºç°å·²åŠ å…¥â€œå¼€æºè½¯ä»¶ä¾›åº”é“¾ç‚¹äº®è®¡åˆ’â€ï¼Œå¦‚æœä½ æƒ³æ”¹å–„Juliaä¸­æ–‡æ–‡æ¡£çš„ç¿»è¯‘ï¼Œé‚£å°±èµ¶å¿«æ¥ <a href="https://summer.iscas.ac.cn/#/org/prodetail/210370191">æŠ¥å</a> å§ï¼</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">è®¾ç½®</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">é€‰æ‹©ä¸»é¢˜</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>æœ¬æ–‡æ¡£åœ¨<span class="colophon-date" title="2021 å…«æœˆ 13 å‘¨äº” 15:31">2021 å…«æœˆ 13 å‘¨äº”</span>ç”±<a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a>ä½¿ç”¨1.6.2ç‰ˆæœ¬çš„Juliaç”Ÿæˆã€‚</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
